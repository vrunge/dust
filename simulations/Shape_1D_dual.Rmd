---
title: | 
   | Shape of the 1D dual function
subtitle:  "Examples in exponential family"
author: "Vincent Runge"
date: "01/11/2023"
output:
  html_document:
    keep_md: true
    css: styles.css
    toc: true
    toc_float: true
    highlight: tango
    number_sections: true
---


```{r setup, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
```

```{r, message=FALSE}
library(dust) #our package
```


# data generators

**dataGenerator_1D** is used to generate data with a given vector of change-point (e.g. `chpts = c(50,100)`), parameter vector (e.g. `parameters = c(0,1)`) and a type of probability distribution in `type`. We have the following choices for type:
  
- `type = "gauss"` (parameter `sdNoise` and `gamma`)

- `type = "exp"` 

- `type = "poisson"`

- `type = "geom"` 

- `type = "bern"` 

- `type = "binom"` (parameter `nbTrials`)

- `type = "negbin"` (parameter `nbSuccess`)

```{r}
dataGenerator_1D(chpts = c(50,100), parameters = c(0,1), sdNoise = 0.2, type = "gauss")
dataGenerator_1D(chpts = c(50,100), parameters = c(0.7,0.2), type = "bern")
dataGenerator_1D(chpts = c(50,100), parameters = c(0.4,0.7), nbSuccess = 10, type = "negbin")
```



# Plots of the 1D dual

We first want to verify the behavior of the dual close to its boundary `mu_max`.

We get `-Inf`:

- when `type = "gauss"` 

- when `type = "exp"` and  `mu_max < 1`

- when `type = "poisson"` and  `mu_max = 1`

In all other cases, we get `0`

We fix the index positions

```{r}
n <- 10
s2 <- 3
s1 <- 5
```

## Case `-Inf` or `0`

### Gauss only `-Inf`

```{r, echo = TRUE}
type <- "gauss"
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type)
```


### exp `-Inf` or `0`

CASE -Inf (`mu_max < 1`)

```{r, echo = FALSE}
type <- "exp"
set.seed(3)
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```

CASE 0 (`mu_max = 1`)

```{r, echo = FALSE}
type <- "exp"
set.seed(10)
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```

### poisson `-Inf` or `0`

CASE -Inf (`mu_max = 1`)

```{r, echo = FALSE}
type <- "poisson"
set.seed(1)
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```

CASE 0 (`mu_max < 1`)

```{r, echo = FALSE}
type <- "poisson"
set.seed(70)
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```



## All cases `0`


### geom 

```{r, echo = FALSE}
type <- "geom"
data <- dataGenerator_1D(chpts = n, parameters = 0.5, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```


### bern 


```{r, echo = FALSE}
type <- "bern"
data <- dataGenerator_1D(chpts = n, parameters = 0.5, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```

### binom 

```{r, echo = FALSE}
type <- "binom"
data <- dataGenerator_1D(chpts = n, parameters = 0.5, nbTrials = 10, type = type)
data <- data/10
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```


### negbin 

```{r, echo = FALSE}
type <- "negbin"
data <- dataGenerator_1D(chpts = n, parameters = 0.5, nbSuccess =  30, type = type)
data <- data/30
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = FALSE)
```



# Pruning positions


```{r, echo = FALSE}
type <- "poisson"
set.seed(12)
data <- dataGenerator_1D(chpts = n, parameters = 1, type = type)
S <- c(0, cumsum(data))
cat("mu max = ", mu_max(S, shift(s1), shift(s2), shift(n), type))
plot_dual_1D(mu = 1:999/1000, data = data, s1 = s1, s2 = s2, type = type, OP = TRUE)
```

```{r}
barplot_dual_1D(nb = 1000, s1 = s1, s2 = s2,
                            n = n,
                            oneParam = 0,
                            type = "gauss",
                            penalty = 2*log(n),
                            pruningOpt = 3)
```



```{r}
barplot_dual_1D(nb = 1000, s1 = s1, s2 = s2,
                            n = n,
                            oneParam = 5,
                            type = "exp",
                            penalty = 2*log(n),
                            pruningOpt = 3)
```




```{r}
barplot_dual_1D(nb = 1000, s1 = s1, s2 = s2,
                            n = n,
                            oneParam = 5,
                            type = "poisson",
                            penalty = 2*log(n),
                            pruningOpt = 3)
```




```{r}
barplot_dual_1D(nb = 1000, s1 = s1, s2 = s2,
                            n = n,
                            oneParam = 0.2,
                            type = "geom",
                            penalty = 2*log(n),
                            pruningOpt = 3)
```



